dbuild: Introduction
====================

Terminology
-----------

Since there are many layers involved, it is useful to introduce first the terminology used in the rest
of this guide.

dbuild build
  A configuration file, and related build process, that builds a set of independent software projects
  (for instance Scala, Akka, Scalacheck) to make sure that they all work together.


dbuild project
  It is one software projects in a dbuild build. A dbuild project can be based on sbt or (in the future)
  on Maven, or other tools. Hence, an entire sbt build (which can contain multiple sbt projects) counts
  as just one dbuild project.

A quick example
---------------

Let's assume we want to make sure that a specific branch or commit of
`sperformance <http://github.com/jsuereth/sperformance>`_ works with a specific branch or commit
of `scala <http://github.com/scala/scala>`_.

A suitable build configuration file is:

.. code-block:: javascript

   {"projects":[
     {
       name:  "scala",
       system: "scala",
       uri:    "git://github.com/scala/scala.git#2.10.x"
     }, {
       name:   "sperformance",
       system: "sbt",
       uri:    "git://github.com/jsuereth/sperformance.git#community"
     }
   ]}

We will put this into a file called ``test.dsbt``. The line "system" specifies the build mechanism used to build each of the
projects (a custom "scala" build system for scala, and "sbt" for sperformance). Let's download dbuild, and try it out (the
exact download instructions and other details are in the following pages):

.. code-block:: bash

   $ [...download and unzip dbuild...]
   $ cd dbuild
   $ [...edit test.dsbt...]
   $ bin/dbuild test.dsbt

Now dbuild will download, parse, and build in turn scala and sperformance, from the branches
"2.10.x" and "community" respectively. You can also specify a commit hash, in place of the branch.

It is important to notice that here sperformance will be forced to use the scala version that
you specify, overriding its normal build settings. In case the build file contains many different projects,
each of them will be tweaked on-the-fly, in order to use the exact combination of branches/commits that you
specified in the configuration file.

dbuild will keep an index of the actual commit ids (git hashes, svn versions, etc) used during that particular
run: the same configuration can later be reproduced again, and prepared for debugging.

At the end of the build, all the of generated artifacts and other information on the build will be stored
in a local repository, contained in your ``~/.dsbt/cache`` directory. If the build ends successfully, you know
that all the network of inter-dependent projects you specified builds together as desired.

What if the build fails?
------------------------

This being a testing tool, at some point it is inevitable that one of the projects will fail to build,
possibly affecting some other projects listed in the dbuild file. It is quite easy to use the information
generated by dbuild in order to debug the failed combination.

During the dbuild run, you will see two lines like:

.. code-block:: text

   [info] ---==  RepeatableBuild ==---
   [info]  uuid = 48baab8156458005cb2e0569e8e8c2c39221d56e

The uuid uniquely identifies the tested combination of projects and commits. Let us assume that
sperformance failed, and that we want to debug it. We can use the sbt plugin as follows (more details at :doc:`plugin`):

.. code-block:: text

   $ git clone -b community http://github.com/jsuereth/sperformance.git
   $ cd sperformance
   $ sbt
   [info] Set current project to sperformance (in build file:/home/cunei/i/sperformance/)
   > dsbt-setup 48baab8156458005cb2e0569e8e8c2c39221d56e
   [info] Retrieving dependencies for 26a265808a6abe8e8451a9f0b43d6dc02176ed16 scala
   [info] Retrieving dependencies for 9fc2901cdc4f1e4ce4209bfad5dfbf02633fcd5f sperformance
   [info] Retrieved from project 26a265808a6abe8e8451a9f0b43d6dc02176ed16: 10 artifacts
   [info] Updating dependencies...
   [info] Adding resolvers to retrieve build artifacts in 1 scopes
   [info] Updating library dependencies in 2 scopes
   [info] Setting Scala version to: 2.10.2-20130320-161312-2f3a7fa417 in 2 scopes
   [info] Disabling cross building in 2 scopes
   [info] Preparing Scala binaries: version 2.10.2-20130320-161312-2f3a7fa417
   [info] Setting Scala home in 1 scopes
   [info] Set current project to sperformance (in build file:/home/cunei/i/sperformance/)
   > 

At this point, all the dependencies of sperformance are exactly as they were during the multi-project dbuild run,
and the code can be debugged.

We will see in the following pages how to download and set up dbuild and the dbuild sbt plugin, and the various
options and features available.

|

.. note::
   dbuild is currently under active development, and should still be considered experimental.
   New features and improvements will be introduced in the coming months: the syntax and other details of
   the tool may change over time.

|

*Next:* :doc:`download`.
